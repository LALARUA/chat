<!doctype html>
<html lang="en">
<html xmlns:th="http://www.thymeleaf.org" class="no-js" lang="zxx">
<head>
    <meta charset="utf-8" >
    <link rel="apple-touch-icon" sizes="76x76" href="/assets/img/apple-icon.png" >
    <link rel="icon" type="image/png" href="/assets/img/favicon.png" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge" >

    <title>Amaze - Bootstrap Admin Dashboard Template</title>

    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' name='viewport' >
    <meta name="viewport" content="width=device-width" >

    <!-- Bootstrap core CSS     -->
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet" >

    <!--  Paper Dashboard CSS    -->
    <link href="/assets/css/amaze.css" rel="stylesheet" >

    <!--  CSS for Demo Purpose, don't include it in your project     -->
    <link href="/assets/css/demo.css" rel="stylesheet" >

    <!--     Fonts and icons     -->
    <link href="/assets/css/font-awesome.min.css" rel="stylesheet">
    <link href="/assets/css/font-muli.css" rel='stylesheet' type='text/css'>
    <link href="/assets/css/themify-icons.css" rel="stylesheet">

    <link href="/assets/vendors/sweetalert/css/sweetalert2.min.css" rel="Stylesheet">
	<style type="text/css">
		#chatWindows{
			height:500px;
			overflow-x:hidden;
			overflow-y:auto;
		}
		#chatWindows{
			scrollbar-face-color: gainsboro;/*移动滑块颜色*/
			scrollbar-shadow-color: black;/*移动滑块边框颜色*/
			scrollbar-track-color: #ccc;/*背景颜色*/
			scrollbar-arrow-color: #ddd;/*箭头颜色*/
		}
		#chatWindows::-webkit-scrollbar-track
		{
			-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
			background-color: #ccc;
		}/* 滚动条的滑轨背景颜色 */
		#chatWindows::-webkit-scrollbar
		{
			width: 6px;
			background-color: #ccc;
		}

		#chatWindows::-webkit-scrollbar-thumb
		{
			background-color: gainsboro;
		}
	</style>
</head>

<body>
    <div class="wrapper">
		<div class="sidebar" data-background-color="brown" data-active-color="danger">
	    <!--
			Tip 1: you can change the color of the sidebar's background using: data-background-color="white | brown"
			Tip 2: you can change the color of the active button using the data-active-color="primary | info | success | warning | danger"
		-->


        </div>
        <div class="main-panel">
            <div class="content">
                <div class="container-fluid">

                    <div class="row">
                        <div class="col-md-12">
							<div class="card card-chat">
								<div class="header">
									<h4 class="title">Chat</h4>
									<p class="category">With Mike Tyson</p>
								</div>
								<div id="chatContent" class="content">
									<ol id="chatWindows" class="chat">
										<li class="self">
									        <div class="msg">
										        <p>
													Hey!
										        	I'm good. How are you?Hey!
													I'm good. How are you?Hey!
													I'm good. How are you?Hey!
													I'm good. How are you?Hey!
													I'm good. How are you?Hey!
													I'm good. How are you?
												</p>
												<div class="card-footer">
													<i class="ti-check"></i>
													<h6>7:21</h6>
												</div>
									        </div>
											<div class="avatar">
												<img src="/assets/img/faces/avatar.png" alt="crash"/>
											</div>
									    </li>
										<li class="other">
											<div class="avatar">
												<img src="/assets/img/faces/avatar.png" alt="crash"/>
											</div>
									        <div class="msg">
									        	<p>
													I'm good too!
												</p>
												<div class="card-footer">
													<i class="ti-check"></i>
													<h6>7:22</h6>
												</div>
										    </div>
									    </li>
										<li class="self">
									        <div class="msg">
									        	<p>
													Let us catchup this weekend!
												</p>
												<div class="card-footer">
													<i class="ti-check"></i>
													<h6>7:23</h6>
												</div>
									        </div>
											<div class="no-avatar"></div>
									    </li>
										<li class="other">
									        <div class="msg">
									        	<p>
													Sure. I'll call you on Friday evening!
									        		See you!
												</p>
												<div class="card-footer">
													<i class="ti-check"></i>
													<h6>7:23</h6>
												</div>
									        </div>
											<div class="avatar">
												<img src="/assets/img/faces/avatar.png" alt="crash"/>
											</div>
									    </li>
									</ol>
									<hr>
									<div class="send-message">
										<div class="avatar">
											<img src="/assets/img/faces/avatar.png" alt="crash"/>
										</div>
										<input class="form-control textarea" id="msg" type="text" placeholder="Type here!"/>
									</div>
								</div>
							</div>
                        </div>
                        <!--<div class="col-md-6">-->
                            <!--<ul class="timeline timeline-simple">-->
                                <!--<li class="timeline-inverted">-->
                                    <!--<div class="timeline-image danger">-->
                                        <!--<img src="/assets/img/faces/avatar.png" alt="">-->
                                    <!--</div>-->
                                    <!--<div class="timeline-panel">-->
                                        <!--<div class="timeline-heading">-->
                                            <!--<span class="label label-danger">Some title</span>-->
                                        <!--</div>-->
                                        <!--<div class="timeline-body">-->
                                            <!--<p>I'm selfish, impatient and a little insecure. I make mistakes, I am out of control and at times hard to handle. But if you can't handle me at my worst, then you sure as hell don't deserve me at my best.</p>-->
                                        <!--</div>-->
                                        <!--<h6>-->
                                            <!--<i class="ti-time"></i> 11 hours ago via Twitter-->
                                        <!--</h6>-->
                                    <!--</div>-->
                                <!--</li>-->
                                <!--<li class="timeline-inverted">-->
                                    <!--<div class="timeline-image success">-->
                                        <!--<img src="/assets/img/faces/avatar.png" alt="">-->
                                    <!--</div>-->
                                    <!--<div class="timeline-panel">-->
                                        <!--<div class="timeline-heading">-->
                                            <!--<span class="label label-success">Another One</span>-->
                                        <!--</div>-->
                                        <!--<div class="timeline-body">-->
                                            <!--<p>Here's to the crazy ones. The misfits. The rebels. The troublemakers. The round pegs in the square holes. The ones who see things differently. They're not fond of rules. And they have no respect for the status quo. You can quote them, disagree with them, glorify or vilify them. About the only thing you can't do is ignore them. Because they change things. They push the human race forward. And while some may see them as the crazy ones, we see genius. Because the people who are crazy enough to think they can change the world, are the ones who do - Rob Siltanen</p>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</li>-->
                                <!--<li class="timeline-inverted">-->
                                    <!--<div class="timeline-image info">-->
                                        <!--<img src="/assets/img/faces/avatar.png" alt="">-->
                                    <!--</div>-->
                                    <!--<div class="timeline-panel">-->
                                        <!--<div class="timeline-heading">-->
                                            <!--<span class="label label-info">Another Title</span>-->
                                        <!--</div>-->
                                        <!--<div class="timeline-body">-->
                                            <!--<p>Called I Miss the Old Kanye That’s all it was Kanye And I love you like Kanye loves Kanye Famous viewing @ Figueroa and 12th in downtown LA 11:10PM</p>-->
                                            <!--<p>What if Kanye made a song about Kanye Royère doesn't make a Polar bear bed but the Polar bear couch is my favorite piece of furniture we own It wasn’t any Kanyes Set on his goals Kanye</p>-->
                                            <!--<hr>-->
                                            <!--<div class="dropdown pull-left">-->
                                                <!--<button type="button" class="btn btn-round btn-info dropdown-toggle" data-toggle="dropdown">-->
                                                    <!--<i class="ti-settings"></i>-->
                                                    <!--<span class="caret"></span>-->
                                                <!--</button>-->
                                                <!--<ul class="dropdown-menu dropdown-menu-right" role="menu">-->
                                                    <!--<li>-->
                                                        <!--<a href="#action">Action</a>-->
                                                    <!--</li>-->
                                                    <!--<li>-->
                                                        <!--<a href="#action">Another action</a>-->
                                                    <!--</li>-->
                                                    <!--<li>-->
                                                        <!--<a href="#here">Something else here</a>-->
                                                    <!--</li>-->
                                                    <!--<li class="divider"></li>-->
                                                    <!--<li>-->
                                                        <!--<a href="#link">Separated link</a>-->
                                                    <!--</li>-->
                                                <!--</ul>-->
                                            <!--</div>-->
                                        <!--</div>-->
                                    <!--</div>-->
                                <!--</li>-->
                            <!--</ul>-->
                        <!--</div>-->
                    </div>

                </div>
            </div>
        </div>
    </div>
<!--   Core JS Files   -->
<script src="/assets/vendors/jquery-3.1.1.min.js" type="text/javascript"></script>
<script src="/assets/vendors/jquery-ui.min.js" type="text/javascript"></script>
<script src="/assets/vendors/bootstrap.min.js" type="text/javascript"></script>
<script src="/assets/vendors/material.min.js" type="text/javascript"></script>
<script src="/assets/vendors/perfect-scrollbar.jquery.min.js" type="text/javascript"></script>
<!-- Forms Validations Plugin -->
<script src="/assets/vendors/jquery.validate.min.js"></script>
<!--  Plugin for Date Time Picker and Full Calendar Plugin-->
<script src="/assets/vendors/moment.min.js"></script>
<!--  Plugin for the Wizard -->
<script src="/assets/vendors/jquery.bootstrap-wizard.js"></script>
<!--  Notifications Plugin    -->
<script src="/assets/vendors/bootstrap-notify.js"></script>
<!-- DateTimePicker Plugin -->
<script src="/assets/vendors/bootstrap-datetimepicker.js"></script>
<!--  Checkbox, Radio, Switch and Tags Input Plugins -->
<script src="/assets/js/bootstrap-checkbox-radio-switch-tags.js"></script>
<!-- Vector Map plugin -->
<script src="/assets/vendors/jquery-jvectormap.js"></script>
<!-- Sliders Plugin -->
<script src="/assets/vendors/nouislider.min.js"></script>
<!--  Google Maps Plugin    -->
<script src="http://ditu.google.cn/maps/api/js?key=AIzaSyAurmSUEQDwY86-wOG3kCp855tCI8lHL-I"></script>
<!-- Select Plugin -->
<script src="/assets/vendors/jquery.select-bootstrap.js"></script>
<!--  DataTables.net Plugin    -->
<script src="/assets/vendors/jquery.datatables.js"></script>
<!-- Sweet Alert 2 plugin -->
<script src="/assets/vendors/sweetalert/js/sweetalert2.min.js"></script>
<!--	Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
<script src="/assets/vendors/jasny-bootstrap.min.js"></script>
<!--  Full Calendar Plugin    -->
<script src="/assets/vendors/fullcalendar.min.js"></script>
<!-- TagsInput Plugin -->
<script src="/assets/vendors/jquery.tagsinput.js"></script>
<!-- Material Dashboard javascript methods -->
<script src="/assets/js/amaze.js"></script>
<!-- Material Dashboard DEMO methods, don't include it in your project! -->
<script src="/assets/js/demo.js"></script>
<script th:inline="javascript">
    $(document).ready(function() {
        demo.initSmallGoogleMaps();
    });
    window.onload=function (ev) {

        var username = [[${username}]]

		var hostAddress = [[${hostAddress}]]

        function getWebSocket() {
            /**
             * WebSocket客户端 PS：URL开头表示WebSocket协议 中间是域名端口 结尾是服务端映射地址
             */
            var webSocket = new WebSocket('ws://172.18.60.82:8080/chatServer/'+username);
            /**
             * 当服务端打开连接
             */
            webSocket.onopen = function (event) {
                console.log('WebSocket打开连接');
            };

            /**
             * 当服务端发来消息：1.广播消息 2.更新在线人数
             */
            webSocket.onmessage = function (event) {
                console.log('WebSocket收到消息：%c' + event.data, 'color:green');
                //获取服务端消息
                var message = event.data;
				$("#chatWindows").append("\t<li class=\"other\">\n" +
					"\t\t\t\t\t\t\t\t\t\t\t<div class=\"avatar\">\n" +
					"  \t\t\t\t\t\t\t\t\t\t\t  <img src=\"/assets/img/faces/avatar.png\" alt=\"crash\"/>\n" +
					"  \t\t\t\t\t\t\t\t\t\t  </div>\n" +
					"\t\t\t\t\t\t\t\t\t        <div class=\"msg\">\n" +
					"\t\t\t\t\t\t\t\t\t\t        <p>\n" +message+

					"\t\t\t\t\t\t\t\t\t\t\t    </p>\n" +
					"\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"card-footer\">\n" +
					"\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"ti-check\"></i>\n" +
					"\t\t\t\t\t\t\t\t\t\t\t\t\t<h6>7:10</h6>\n" +
					"\t\t\t\t\t\t\t\t\t\t\t\t</div>\n" +
					"\t\t\t\t\t\t\t\t\t\t  </div>\n" +
					"\t\t\t\t\t\t\t\t\t    </li>")

				scrollToBottom();
                // $('.chat-num').text(message.onlineCount);
                // //防止刷屏
                // var $cards = $messageContainer.children('.mdui-card:visible').toArray();
                // if ($cards.length > 5) {
                //     $cards.forEach(function (item, index) {
                //         index < $cards.length - 5 && $(item).slideUp('fast');
                //     });
                // }
            };

            /**
             * 关闭连接
             */
            webSocket.onclose = function (event) {
                console.log('WebSocket关闭连接');
            };

            /**
             * 通信失败
             */
            webSocket.onerror = function (event) {
                console.log('WebSocket发生异常');

            };
            return webSocket;
        }

        var webSocket = getWebSocket();


        /**
         * 通过WebSocket对象发送消息给服务端
         */
        function sendMsgToServer() {
            var date = new Date();
            var hour = date.getHours();
            var min = date.getMinutes();
            var sec = date.getSeconds();
            var time = hour+":"+min+":"+sec;
            var $message = $('#msg');
            if ($message.val()) {
                webSocket.send(JSON.stringify({username: username, msg: $message.val()}));
				$("#chatWindows").append("\t<li class=\"self\">\n" +
                    "\t\t\t\t\t\t\t\t\t\t\t<div class=\"avatar\">\n" +
                    "  \t\t\t\t\t\t\t\t\t\t\t  <img src=\"/assets/img/faces/avatar.png\" alt=\"crash\"/>\n" +
                    "  \t\t\t\t\t\t\t\t\t\t  </div>\n" +
                    "\t\t\t\t\t\t\t\t\t        <div class=\"msg\">\n" +
                    "\t\t\t\t\t\t\t\t\t\t        <p>\n" +$message.val()+

                    "\t\t\t\t\t\t\t\t\t\t\t    </p>\n" +
                    "\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"card-footer\">\n" +
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t<i class=\"ti-check\"></i>\n" +
                    "\t\t\t\t\t\t\t\t\t\t\t\t\t<h6>"+time+"</h6>\n" +
                    "\t\t\t\t\t\t\t\t\t\t\t\t</div>\n" +
                    "\t\t\t\t\t\t\t\t\t\t  </div>\n" +
                    "\t\t\t\t\t\t\t\t\t    </li>")
                $message.val(null);
            }
			scrollToBottom();

        }
        function scrollToBottom() {
			var scrollHeight = $('#chatWindows').prop("scrollHeight");
			$('#chatWindows').animate({scrollTop:scrollHeight}, 400);
		}
        /**
         * 清屏
         */
        function clearMsg(){
            $("#chatWindows").empty();
        }
        function dateDifference(sDate1, sDate2) {    //sDate1和sDate2是2006-12-18格式
            var dateSpan,
                tempDate,
                iDays;
            sDate1 = Date.parse(sDate1);
            sDate2 = Date.parse(sDate2);
            dateSpan = sDate2 - sDate1;
            dateSpan = Math.abs(dateSpan);
            iDays = Math.floor(dateSpan / (24 * 3600 * 1000));
            return iDays
        };

        function dateFormat(fmt, date) {
            var ret;
            var opt = {
                "y+": date.getFullYear().toString(),        // 年
                "M+": (date.getMonth() + 1).toString(),     // 月
                "d+": date.getDate().toString(),            // 日
                "h+": date.getHours().toString(),           // 时
                "m+": date.getMinutes().toString(),         // 分
                "s+": date.getSeconds().toString()          // 秒
                // 有其他格式化字符需求可以继续添加，必须转化成字符串
            };
            for (let k in opt) {
                ret = new RegExp("(" + k + ")").exec(fmt);
                if (ret) {
                    fmt = fmt.replace(ret[1], (ret[1].length == 1) ? (opt[k]) : (opt[k].padStart(ret[1].length, "0")))
                };
            };
            return fmt;
        }

        /**
         * 使用ENTER发送消息
         */
        document.onkeydown = function (event) {
            var e = event || window.event || arguments.callee.caller.arguments[0];
            e.keyCode === 13 && sendMsgToServer();
        };

    }
</script>
</body>
</html>
